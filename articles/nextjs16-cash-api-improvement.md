---
title: "Next.16で改善されたキャッシュAPIを調査したんじゃ"
emoji: "✏️"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["Next.js","cash"]
published: false
# published_at: 2025-11-01 21:30
publication_name: "genai"
---
# 初めに
気づいたら11月、今年ももう少しで終わりですね〜
どうでもいいんですけど、Fischer’sの増量中を会社でやりたいなと密かに思っています。（絶対にここで書く事ではないのだけど）
さて今回はNext.16で改善されたキャッシュAPI主にrevalidateTag・updateTag・refreshの使い分けや使い方を詳しく見ていこうと思います。

# revalidateTag：キャッシュデータのタグ無効化と再検証
revalidateTag は指定したタグに紐づくキャッシュデータをオンデマンドで「無効化（再検証対象にする）」する関数です。**主に多少の遅延が許容されるコンテンツ**に適しており、データをすぐ最新化する必要がないケース（ブログ記事、商品カタログ、ドキュメントなど）で利用するのが一般的です。
無効化後、ユーザーには現在のキャッシュ（古いデータ）が提供されつつ、バックグラウンドで新しいデータのフェッチ・更新が行われます。
### 使用できる場所
サーバーサイドのコンテキストである Server Action（サーバーアクション）や Route Handler（APIルート）内部で呼び出せます。クライアントコンポーネント内や直接ブラウザ上では使用できません。
### 使い方
デフォルトでは第二引数にキャッシュのライフタイムプロファイル`max`を指定して使用します。この`profile=max`を付けることで stale-while-revalidate が有効になり、**キャッシュを即座に削除せず「古いデータを見せながら裏で再取得」**する動作になります。ユーザーには遅延なく旧データが表示され、更新完了後に新データへ切り替わります。
第二引数を省略すると即時にキャッシュを無効化します（次のリクエスト時に強制的に再フェッチ・再レンダリングを行う）ですが、この一引数のみの使用法は非推奨になりました。Next.js 16では、即時再検証が必要な場合は後述のupdateTagへの移行が推奨されています。
タグ付きキャッシュデータを扱うため、あらかじめfetch関数のオプション`next: { tags: [...] }`でタグを付与するか、`'use cache'`指令を用いる関数内で`cacheTag('tagName')`を指定してデータにタグ付けしておく必要があります。
